document.addEventListener("DOMContentLoaded",()=>{let e=async()=>{let e=async(e,t)=>{try{let s=await fetch(t);if(!s.ok)throw Error(`Failed to fetch ${t}`);let i=await s.text(),l=document.getElementById(e);if(l){let n=window.location.pathname,r=(n.match(/\//g)||[]).length-1;if(r>0){let a="/".repeat(r);i=i.replace(/(src="|href=")\//g,`$1${a}`)}l.innerHTML=i}}catch(o){console.error("Component load error:",o)}};await Promise.all([e("header-placeholder","../../header.html"),e("footer-placeholder","../../footer.html")]),t(),i(),l()},t=()=>{let e=document.querySelector(".mobile-nav-toggle"),t=document.querySelector(".nav-links");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active")})},s=()=>{let e=document.querySelectorAll(".fade-in");if(0===e.length)return;let t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e.target.classList.add("visible"),t.unobserve(e.target))})},{threshold:.1});e.forEach(e=>t.observe(e))},i=()=>{let e=document.querySelector(".site-header");e&&window.addEventListener("scroll",()=>{e.classList.toggle("scrolled",window.scrollY>50)})},l=()=>{let e=document.querySelectorAll(".nav-links a"),t=window.location.pathname;e.forEach(e=>{let s=new URL(e.href).pathname,i="/"===t||t.endsWith("/index.html"),l="/"===s||s.endsWith("/index.html");i&&l?e.classList.add("nav-active"):!l&&t.includes(s.substring(1))&&e.classList.add("nav-active")})},n=()=>{document.body.addEventListener("click",e=>{let t=e.target.closest(".gallery-toggle-btn");if(!t)return;let s=t.closest(".portfolio-card"),i=s.querySelector(".thumbnail-gallery-wrapper");i&&(i.classList.toggle("open"),t.innerHTML=i.classList.contains("open")?'<i class="fas fa-times-circle"></i> ギャラリーを閉じる':'<i class="fas fa-images"></i> ギャラリーを見る')})},r=()=>{document.body.addEventListener("click",e=>{let t=e.target.closest(".copy-btn");if(!t||t.classList.contains("copied"))return;let s=t.closest(".prompt-box");if(!s)return;let i=s.querySelector(".prompt-text");if(!i)return;let l=i.innerText;navigator.clipboard.writeText(l).then(()=>{let e=t.innerHTML;t.classList.add("copied"),t.innerHTML='<i class="fas fa-check"></i> コピー完了',setTimeout(()=>{t.classList.remove("copied"),t.innerHTML=e},2e3)}).catch(e=>console.error("クリップボードへのコピーに失敗しました: ",e))})},a=()=>{let e=document.querySelector(".portfolio-categories, #level-filters");if(!e)return;let t=document.querySelectorAll(".portfolio-item"),s="all",i="all",l=()=>{t.forEach(e=>{let t=e.dataset.category?e.dataset.category.split(" "):[],l=e.dataset.level||"all",n="all"===s||t.includes(s),r="all"===i||l===i;e.style.display=n&&r?"block":"none"})};document.body.addEventListener("click",e=>{let t=e.target.closest(".category-btn");if(!t)return;let n=t.parentElement.id;if("category-filters"===n){s=t.dataset.category,document.querySelectorAll("#category-filters .category-btn").forEach(e=>e.classList.remove("active"));let r=document.querySelector('#level-filters [data-level="all"]');r&&r.click()}else if("level-filters"===n){i=t.dataset.level,document.querySelectorAll("#level-filters .category-btn").forEach(e=>e.classList.remove("active"));let a=document.querySelector('#category-filters [data-category="all"]');a&&a.click()}t.classList.add("active"),l()})},o=()=>{setTimeout(()=>{if(void 0===SiteWideSpeaker||!window.siteSpeaker||window.siteSpeaker.isLoading){setTimeout(o,200);return}let e=document.querySelectorAll(".article-content p, .article-content h2, .article-content h3, .article-content li, .lesson-content p, .lesson-content h2, .lesson-content h3, .lesson-content li, .novel-content p, .novel-content h2, .readable");e.forEach(e=>{if(e.parentElement.closest(".readable")&&!e.classList.contains("readable")||""===e.textContent.trim()||e.classList.contains("post-card-category")||e.classList.contains("article-meta")||e.querySelector(".speech-button"))return;let t=document.createElement("button");t.className="speech-button",t.innerHTML='<i class="fas fa-volume-up" style="font-size: 12px;"></i>',t.title="この部分を読み上げる",t.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation();let s;if(e.dataset.speech)s=e.dataset.speech;else{let i=e.cloneNode(!0),l=i.querySelector(".speech-button");l&&l.remove();let n=i.querySelectorAll("[data-speech]");n.forEach(e=>{e.textContent=e.dataset.speech}),s=i.textContent.trim()}window.siteSpeaker.speak(s,e)}),e.appendChild(t)})},300)},c=()=>{setTimeout(()=>{if(void 0===SiteWideSpeaker||!window.siteSpeaker||window.siteSpeaker.isLoading){setTimeout(c,200);return}let e=document.querySelectorAll(".article-content, .lesson-content, .novel-content");e.forEach(e=>{e.querySelectorAll("img").forEach(e=>{let t=e.getAttribute("alt");t&&""!==t.trim()&&(e.classList.add("speech-target-image"),e.setAttribute("title","クリックして画像の説明を読み上げる"),e.addEventListener("click",s=>{s.stopPropagation(),e.classList.add("speaking-image"),window.siteSpeaker.speak(t,null,()=>{e.classList.remove("speaking-image")})}))})})},300)};e(),s(),n(),r(),a(),o(),c()});class SiteWideSpeaker{constructor(e,t){this.synth=window.speechSynthesis,this.voices=[],this.isLoading=!0,this.currentUtterance=null,this.currentHighlightElement=null,this.controlPanel=document.getElementById(e),this.stopButton=document.getElementById(t),this.loadVoices(),this.bindEvents()}loadVoices(){if(!("speechSynthesis"in window)){console.warn("このブラウザは音声合成に対応していません。"),this.isLoading=!1;return}let e=()=>{this.voices=this.synth.getVoices().filter(e=>"ja-JP"===e.lang),this.isLoading=!1};void 0!==this.synth.onvoiceschanged&&(this.synth.onvoiceschanged=e),e()}bindEvents(){this.stopButton&&this.stopButton.addEventListener("click",()=>this.stop())}stop(){this.synth.speaking&&this.synth.cancel()}showControls(){this.controlPanel&&(this.controlPanel.classList.remove("hidden"),this.controlPanel.classList.add("visible"))}hideControls(){this.controlPanel&&(this.controlPanel.classList.remove("visible"),this.controlPanel.classList.add("hidden"))}speak(e,t,s=null){if(this.isLoading)return;this.synth.speaking&&this.synth.cancel(),this.currentHighlightElement&&(this.currentHighlightElement.style.backgroundPosition="0 100%"),this.currentUtterance=new SpeechSynthesisUtterance(e);let i=this.voices.find(e=>"Google 日本語"===e.name)||this.voices.find(e=>e.name.includes("Microsoft Ayumi"))||this.voices.find(e=>"Kyoko"===e.name);this.currentUtterance.voice=i||this.voices[0],this.currentUtterance.lang="ja-JP",this.currentUtterance.rate=1,this.currentUtterance.pitch=1.1,this.currentHighlightElement=t,this.currentUtterance.onstart=()=>{this.showControls(),this.currentHighlightElement&&(this.currentHighlightElement.style.backgroundPosition="0 0")},this.currentUtterance.onend=()=>{this.hideControls(),this.currentHighlightElement&&(this.currentHighlightElement.style.backgroundPosition="0 100%"),this.currentUtterance=null,this.currentHighlightElement=null,s&&s()},this.currentUtterance.onerror=e=>{console.error("SpeechSynthesisUtterance.onerror",e),this.hideControls(),this.currentHighlightElement&&(this.currentHighlightElement.style.backgroundPosition="0 100%"),s&&s()},this.synth.speak(this.currentUtterance)}}window.siteSpeaker=new SiteWideSpeaker("global-speech-control","global-speech-stop-btn");
// ===== HubSpot Chat Widget Loader =====
function loadHubSpotWidget() {
  const script = document.createElement('script');
  script.type = 'text/javascript';
  script.id = 'hs-script-loader';
  script.async = true;
  script.defer = true;
  script.src = '//js-na2.hs-scripts.com/243859617.js';
  document.body.appendChild(script);
}

// ページの読み込みが完了してから実行する
window.addEventListener('load', loadHubSpotWidget);